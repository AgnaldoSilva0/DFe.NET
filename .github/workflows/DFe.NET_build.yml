name: DFe.NET_build

on:
  push:
    branches: [ release ]
  pull_request:
    branches: [ release ]

jobs:
  build:

    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
    #    os: [ ubuntu-latest, windows-latest, macos-latest ]
        os: [ windows-2022 ]
    steps:
    - name: Checkout
    - uses: actions/checkout@v3
    
    - name: Setando Versao
      id: date
      run: echo "::set-output name=date::$(date +'%Y.%m.%d.%H%M')"
      
    - name: Versao
      run: echo ${{ steps.date.outputs.date }}
      
    - name: Setup .NET 6.0.x
      uses: actions/setup-dotnet@v2
      with:
        dotnet-version: 6.0.x
    
    - name: Build/Restore Base
      run: | 
        dotnet build ".\DFe.Classes\DFe.Classes.csproj" -c "Release"
        dotnet build ".\DFe.Utils\DFe.Utils.csproj" -c "Release"
        dotnet build ".\DFe.Wsdl\DFe.Wsdl.csproj" -c "Release"
    - name: Build/Restore NFe
      run: | 
        dotnet build ".\NFe.Classes\NFe.Classes.csproj" -c "Release"
        dotnet build ".\NFe.Servicos\NFe.Servicos.csproj" -c "Release"
        dotnet build ".\NFe.Utils\NFe.Utils.csproj" -c "Release"
        dotnet build ".\NFe.Wsdl\NFe.Wsdl.csproj" -c "Release"
        dotnet build ".\NFe.Wsdl.Standard\NFe.Wsdl.Standard.csproj" -c "Release"
        
    - name: Build/Restore MDFe
      run: | 
        dotnet build ".\MDFe.Classes\MDFe.Classes.csproj" -c "Release"
        dotnet build ".\MDFe.Servicos\MDFe.Servicos.csproj" -c "Release"
        dotnet build ".\MDFe.Utils\MDFe.Utils.csproj" -c "Release"
        dotnet build ".\MDFe.Wsdl\MDFe.Wsdl.csproj" -c "Release"
        
    - name: Build/Restore MDFe
      run: | 
        dotnet build ".\CTe.Classes\CTe.Classes.csproj" -c "Release"
        dotnet build ".\CTe.Servicos\CTe.Servicos.csproj" -c "Release"
        dotnet build ".\CTe.Utils\CTe.Utils.csproj" -c "Release"
        dotnet build ".\CTe.Wsdl\CTe.Wsdl.csproj" -c "Release"
        
    #- name: Test
    #  run: dotnet test --no-build --verbosity normal
  
    - name: Pack Zeus.Net.NFe.NFCe
      run: dotnet pack -v minimal -c Release --no-restore -p:NuspecProperties=version=${{ steps.date.outputs.date }} -p:PackageVersion=${{ steps.date.outputs.date }} NuGet\Zeus.Net.NFe.NFCe\Zeus.Net.NFe.NFCe.csproj

    - name: Upload Artifact Zeus.Net.NFe.NFCe
      uses: actions/upload-artifact@v3
      with:
        name: nupkg
        path: NuGet/**/bin/Release/*.nupkg